<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Routing Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .route-test {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üõí Customer Flow & Routing Test</h1>
    
    <div class="section">
        <h2>Customer Routes Test</h2>
        <div class="route-test">
            <h3>1. Shop List Page</h3>
            <a href="http://localhost:4200/customer/shops" target="_blank">http://localhost:4200/customer/shops</a>
            <button onclick="testShopsPage()">Test Shop List</button>
            <div id="shops-result"></div>
        </div>
        
        <div class="route-test">
            <h3>2. Product List Page (Shop 16)</h3>
            <a href="http://localhost:4200/customer/products/16" target="_blank">http://localhost:4200/customer/products/16</a>
            <button onclick="testProductsPage()">Test Products</button>
            <div id="products-result"></div>
        </div>
        
        <div class="route-test">
            <h3>3. Shopping Cart</h3>
            <a href="http://localhost:4200/customer/cart" target="_blank">http://localhost:4200/customer/cart</a>
        </div>
        
        <div class="route-test">
            <h3>4. Checkout</h3>
            <a href="http://localhost:4200/customer/checkout" target="_blank">http://localhost:4200/customer/checkout</a>
        </div>
    </div>

    <div class="section">
        <h2>API Test Results</h2>
        <button onclick="testAllAPIs()">Test All Customer APIs</button>
        <div id="api-results"></div>
    </div>

    <div class="section">
        <h2>Routing Diagnostics</h2>
        <button onclick="checkRouting()">Check Angular Routes</button>
        <div id="routing-results"></div>
    </div>

    <script>
        async function testShopsPage() {
            const resultDiv = document.getElementById('shops-result');
            resultDiv.innerHTML = '<p>Testing shops API...</p>';
            
            try {
                const response = await fetch('http://localhost:8082/api/customer/shops');
                const data = await response.json();
                
                if (data.statusCode === '0000') {
                    const shops = data.data?.content || [];
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ API Working - Found ${shops.length} shops</p>
                        <p>First shop: ${shops[0]?.name} (ID: ${shops[0]?.id})</p>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå API Error: ${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Network Error: ${error.message}</p>`;
            }
        }

        async function testProductsPage() {
            const resultDiv = document.getElementById('products-result');
            resultDiv.innerHTML = '<p>Testing products API for shop 16...</p>';
            
            try {
                const response = await fetch('http://localhost:8082/api/customer/shops/16/products');
                const data = await response.json();
                
                if (data.statusCode === '0000') {
                    const products = data.data?.content || [];
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ API Working - Found ${products.length} products</p>
                        <p>Sample products:</p>
                        <ul>
                            ${products.slice(0, 3).map(p => 
                                `<li>${p.masterProduct?.name || p.name} - ‚Çπ${p.price}</li>`
                            ).join('')}
                        </ul>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå API Error: ${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Network Error: ${error.message}</p>`;
            }
        }

        async function testAllAPIs() {
            const resultDiv = document.getElementById('api-results');
            resultDiv.innerHTML = '<h3>Testing all customer APIs...</h3>';
            
            const tests = [
                { name: 'Get Shops', url: 'http://localhost:8082/api/customer/shops' },
                { name: 'Get Shop Details', url: 'http://localhost:8082/api/customer/shops/16' },
                { name: 'Get Products', url: 'http://localhost:8082/api/customer/shops/16/products' },
                { name: 'Search Products', url: 'http://localhost:8082/api/customer/shops/16/products?search=phone' }
            ];
            
            let results = [];
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    const data = await response.json();
                    if (data.statusCode === '0000') {
                        results.push(`<p class="success">‚úÖ ${test.name}: Success</p>`);
                    } else {
                        results.push(`<p class="error">‚ùå ${test.name}: ${data.message}</p>`);
                    }
                } catch (error) {
                    results.push(`<p class="error">‚ùå ${test.name}: ${error.message}</p>`);
                }
            }
            
            resultDiv.innerHTML = '<h3>API Test Results:</h3>' + results.join('');
        }

        async function checkRouting() {
            const resultDiv = document.getElementById('routing-results');
            
            const routes = [
                '/customer',
                '/customer/shops',
                '/customer/products/16',
                '/customer/cart',
                '/customer/checkout'
            ];
            
            resultDiv.innerHTML = `
                <h3>Angular Route Configuration:</h3>
                <p>Customer module is lazy-loaded at <code>/customer</code></p>
                <p>Customer routes:</p>
                <ul>
                    <li><code>/customer</code> ‚Üí redirects to ‚Üí <code>/customer/shops</code></li>
                    <li><code>/customer/shops</code> ‚Üí ShopListComponent</li>
                    <li><code>/customer/products/:id</code> ‚Üí ProductListComponent</li>
                    <li><code>/customer/cart</code> ‚Üí ShoppingCartComponent</li>
                    <li><code>/customer/checkout</code> ‚Üí CheckoutComponent</li>
                </ul>
                <h3>Quick Navigation Test:</h3>
                ${routes.map(route => 
                    `<a href="http://localhost:4200${route}" target="_blank" 
                        style="display: block; margin: 5px 0; padding: 5px; background: #f0f0f0; text-decoration: none;">
                        Test: ${route}
                    </a>`
                ).join('')}
            `;
        }

        // Run tests on load
        window.onload = function() {
            testShopsPage();
        }
    </script>
</body>
</html>
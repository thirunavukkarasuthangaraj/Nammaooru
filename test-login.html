<!DOCTYPE html>
<html>
<head>
    <title>Authentication Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîê Authentication Flow Test</h1>
    
    <div class="test-section">
        <h2>Test Credentials</h2>
        <p><strong>Password for all users:</strong> password123</p>
        <p><strong>BCrypt Hash in DB:</strong> $2a$10$eImiTXuWVxfM37uY4JANjOQxr1TnDQs8vZXrPjSKPqYFvZfG5KQJm</p>
    </div>

    <div class="test-section">
        <h2>1. Test SUPER_ADMIN Login</h2>
        <button onclick="testLogin('superadmin', 'password123')">Test superadmin</button>
        <button onclick="testLogin('testsuper', 'password123')">Test testsuper</button>
        <div id="superadmin-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Test SHOP_OWNER Login</h2>
        <button onclick="testLogin('shopowner1', 'password123')">Test shopowner1</button>
        <button onclick="testLogin('shopowner', 'password123')">Test shopowner</button>
        <div id="shopowner-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Test CUSTOMER Login</h2>
        <button onclick="testLogin('customer1', 'password123')">Test customer1</button>
        <button onclick="testLogin('testuser', 'password123')">Test testuser</button>
        <div id="customer-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Test JWT Token</h2>
        <button onclick="testProtectedEndpoint()">Test Protected Endpoint</button>
        <div id="jwt-result"></div>
    </div>

    <script>
        let currentToken = null;

        async function testLogin(username, password) {
            const resultDiv = document.getElementById(username.includes('super') ? 'superadmin-result' : 
                                                    username.includes('shop') ? 'shopowner-result' : 'customer-result');
            
            try {
                const response = await fetch('http://localhost:8082/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    currentToken = data.accessToken;
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ Login Successful!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">‚ùå Login Failed</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testProtectedEndpoint() {
            const resultDiv = document.getElementById('jwt-result');
            
            if (!currentToken) {
                resultDiv.innerHTML = '<div class="error">Please login first to get a token</div>';
                return;
            }

            try {
                const response = await fetch('http://localhost:8082/api/users/profile', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">‚úÖ JWT Token Valid!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">‚ùå JWT Token Invalid</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
          xmlns:tools="http://schemas.android.com/tools">

 <!-- Internet permission -->
<uses-permission android:name="android.permission.INTERNET" />

<!-- ❌ Explicitly REMOVE QUERY_ALL_PACKAGES permission added by dependencies -->
<uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" tools:node="remove" />

<!-- Location permissions (foreground only) -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />

<!-- Camera permission -->
<uses-permission android:name="android.permission.CAMERA" />

<!-- Storage permissions -->
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />

<!-- Phone permission -->
<uses-permission android:name="android.permission.CALL_PHONE" />

<!-- Notifications & vibration -->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
<uses-permission android:name="android.permission.WAKE_LOCK" />
<uses-permission android:name="android.permission.VIBRATE" />

<!-- Biometric authentication -->
<uses-permission android:name="android.permission.USE_BIOMETRIC" />
<!-- (USE_FINGERPRINT deprecated — removed) -->

<!-- Audio recording (speech-to-text, mic use) -->
<uses-permission android:name="android.permission.RECORD_AUDIO" />

<!-- Network monitoring -->
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />

<!-- Foreground service (removed FOREGROUND_SERVICE_LOCATION to comply with Play Store policy) -->
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />

<!-- ✅ Queries block (safe replacement for QUERY_ALL_PACKAGES) -->
<queries>
    <!-- Only include the packages/intents your app really interacts with -->
    <intent>
        <action android:name="android.intent.action.PROCESS_TEXT" />
        <data android:mimeType="text/plain" />
    </intent>
    <!-- Required for url_launcher to open HTTP/HTTPS URLs -->
    <intent>
        <action android:name="android.intent.action.VIEW" />
        <data android:scheme="https" />
    </intent>
    <intent>
        <action android:name="android.intent.action.VIEW" />
        <data android:scheme="http" />
    </intent>
    <!-- Required for url_launcher to make phone calls (tel:) -->
    <intent>
        <action android:name="android.intent.action.DIAL" />
        <data android:scheme="tel" />
    </intent>
    <!-- Required for url_launcher to send SMS -->
    <intent>
        <action android:name="android.intent.action.SENDTO" />
        <data android:scheme="sms" />
    </intent>
</queries>


    <application
        android:label="NammaOoru"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:allowBackup="false"
        android:usesCleartextTraffic="true">
        
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize">
            
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
              
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>
        
        <!-- Google Maps API Key -->
        <meta-data android:name="com.google.android.geo.API_KEY"
                   android:value="AIzaSyAr_uGbaOnhebjRyz7ohU6N-hWZJVV_R3U"/>

        <!-- Firebase Cloud Messaging Notification Icon -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_icon"
            android:resource="@mipmap/ic_launcher" />

        <!-- Firebase Cloud Messaging Notification Color -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_color"
            android:resource="@android:color/holo_green_dark" />

        <!-- Firebase Cloud Messaging Channel -->
        <meta-data
            android:name="com.google.firebase.messaging.default_notification_channel_id"
            android:value="nammaooru_notifications" />

        <!-- Firebase Cloud Messaging - Disabled for now -->
        <!-- TODO: Create MessagingService class when Firebase is properly configured
        <service
            android:name=".firebase.MessagingService"
            android:exported="false">
            <intent-filter>
                <action android:name="com.google.firebase.MESSAGING_EVENT" />
            </intent-filter>
        </service>
        -->
        
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
    </application>
    
    <!-- Required to query activities that can process text -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT" />
            <data android:mimeType="text/plain" />
        </intent>
    </queries>
</manifest>
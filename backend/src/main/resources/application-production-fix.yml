# Alternative production configuration with fixed upload paths
# Use this if /var/www permissions are problematic

server:
  port: ${PORT:8080}
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
    min-response-size: 1024
  forward-headers-strategy: framework

spring:
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/shop_management_db}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
    
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: false
        jdbc:
          time_zone: UTC
    open-in-view: false
    
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB
  
  mail:
    host: ${MAIL_HOST:smtp.hostinger.com} 
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:noreplay@nammaoorudelivary.in}
    password: ${MAIL_PASSWORD:noreplaynammaooruDelivary@2025}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 3000
          writetimeout: 5000

# File Storage Configuration - FIXED PATHS
file:
  storage:
    type: ${FILE_STORAGE_TYPE:local}
    local:
      # Use home directory or /opt which usually has better permissions
      base-path: ${FILE_STORAGE_PATH:/opt/shop-management/uploads}
      serve-url: ${FILE_SERVE_URL:https://nammaoorudelivary.in/uploads}
  
  upload:
    # Use relative path if absolute path fails
    path: ${FILE_UPLOAD_PATH:uploads}
    max-size: 10485760
    allowed-extensions: jpg,jpeg,png,gif,webp

# Application upload paths - FIXED
app:
  upload:
    # Try using home directory or /opt instead of /var/www
    dir: ${APP_UPLOAD_DIR:/opt/shop-management/uploads}
    documents:
      path: ${DOCUMENT_UPLOAD_PATH:/opt/shop-management/uploads/documents}
    product-images: ${PRODUCT_IMAGES_PATH:products}
    max-file-size: 10MB
    allowed-types: pdf,jpg,jpeg,png,docx,doc,webp
    
  frontend:
    base-url: ${FRONTEND_BASE_URL:https://nammaoorudelivary.in}

  # CORS is configured in SecurityConfig.java - DO NOT configure here to avoid duplicate headers
  # cors:
  #   allowed-origins: ${CORS_ALLOWED_ORIGINS:https://nammaoorudelivary.in,https://www.nammaoorudelivary.in,https://api.nammaoorudelivary.in,http://localhost:4200,http://localhost:80}
  #   allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH,HEAD
  #   allowed-headers: "*"
  #   allow-credentials: true
  #   exposed-headers: Authorization,Content-Type,X-Total-Count

jwt:
  secret: ${JWT_SECRET}
  expiration: 86400000

# Gemini AI Configuration
gemini:
  enabled: ${GEMINI_ENABLED:true}
  # Multiple API keys for rotation (15 RPM each = 60 RPM total)
  api-keys:
    - ${GEMINI_API_KEY_1:AIzaSyCGt_F5WfqMZwr5UDkvOKWSuMQkkNRxoTc}
    - ${GEMINI_API_KEY_2:AIzaSyAYqI-DsGx4QWBjyS9K8P9uSqMEcD7CmQo}
    - ${GEMINI_API_KEY_3:AIzaSyDvKELg3zFky3G2Pg0uN2_NV5BoIl9JiQE}
    - ${GEMINI_API_KEY_4:AIzaSyA-SdjVz-rnQbPk17e9k2FSq6LY_svGB3Q}
  model: ${GEMINI_MODEL:gemini-1.5-flash}
  api-url: https://generativelanguage.googleapis.com/v1beta/models
  rate-limit:
    per-key-rpm: 15  # Requests per minute per key
    total-rpm: 60     # Total requests per minute (4 keys Ã— 15)

logging:
  level:
    com.shopmanagement: INFO
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
  file:
    name: /var/log/shop-management/app.log
    max-size: 10MB
    max-history: 30

management:
  health:
    mail:
      enabled: false
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
  metrics:
    export:
      prometheus:
        enabled: true
<div class="browse-products-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <button mat-icon-button (click)="goBack()" *ngIf="selectedShop">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div>
        <h1>{{ selectedShop ? selectedShop.name + ' Products' : 'Browse Products from Other Shops' }}</h1>
        <p *ngIf="!selectedShop">Discover and import products from other shops in the network</p>
        <p *ngIf="selectedShop">Select products to import into your shop</p>
      </div>
    </div>
    <div class="header-actions" *ngIf="selectedShop && selectedProducts.length > 0">
      <span class="selected-count">{{ selectedProducts.length }} selected</span>
      <button mat-button (click)="clearSelection()">Clear</button>
      <button mat-raised-button color="primary" (click)="importSelectedProducts()" [disabled]="loading">
        <mat-icon>add_shopping_cart</mat-icon>
        Import Selected
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>{{ selectedShop ? 'Loading shop products...' : 'Loading shops...' }}</p>
  </div>

  <!-- Shop Selection View -->
  <div class="shops-grid" *ngIf="!selectedShop && !loading">
    <div class="shop-card" 
         *ngFor="let shop of filteredShops" 
         (click)="selectShop(shop)">
      <mat-card>
        <mat-card-content>
          <div class="shop-header">
            <div class="shop-info">
              <h3>{{ shop.name }}</h3>
              <p class="shop-category">{{ shop.category || 'General' }}</p>
            </div>
            <div class="shop-rating" *ngIf="shop.rating">
              <mat-icon>star</mat-icon>
              <span>{{ shop.rating }}</span>
            </div>
          </div>
          <p class="shop-description">{{ shop.description || 'No description available' }}</p>
          <div class="shop-meta">
            <span class="location" *ngIf="shop.location">
              <mat-icon>location_on</mat-icon>
              {{ shop.location }}
            </span>
            <span class="status active">
              <mat-icon>check_circle</mat-icon>
              Active
            </span>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button>
            <mat-icon>visibility</mat-icon>
            View Products
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>

  <!-- Empty Shops State -->
  <div class="empty-state" *ngIf="!selectedShop && !loading && filteredShops.length === 0">
    <div class="empty-icon">
      <mat-icon>store</mat-icon>
    </div>
    <h3>No shops available</h3>
    <p>There are currently no other shops available to browse products from.</p>
  </div>

  <!-- Products View -->
  <div class="products-section" *ngIf="selectedShop && !loading">
    <!-- Filters -->
    <div class="filters-bar">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search products...</mat-label>
        <input matInput 
               [(ngModel)]="searchTerm" 
               (ngModelChange)="onSearchChange()" 
               placeholder="Search by name or description">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
      
      <mat-form-field appearance="outline">
        <mat-label>Category</mat-label>
        <mat-select [(ngModel)]="selectedCategory" (selectionChange)="onCategoryChange()">
          <mat-option value="">All Categories</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Products Grid -->
    <div class="products-grid" *ngIf="filteredProducts.length > 0">
      <div class="product-card" 
           *ngFor="let product of filteredProducts"
           [class.selected]="isProductSelected(product)">
        <mat-card>
          <div class="product-image">
            <img [src]="product.imageUrl || '/assets/images/no-image.png'" 
                 [alt]="product.customName">
            <mat-checkbox 
              [checked]="isProductSelected(product)"
              (change)="toggleProductSelection(product)"
              class="selection-checkbox">
            </mat-checkbox>
          </div>
          
          <mat-card-content>
            <h3>{{ product.customName }}</h3>
            <p class="product-description">{{ product.description || 'No description' }}</p>
            
            <div class="product-info">
              <div class="price-info">
                <span class="price">{{ formatCurrency(product.price) }}</span>
                <span class="unit">per {{ product.unit || 'piece' }}</span>
              </div>
              
              <div class="stock-info">
                <span class="stock" [class.low-stock]="product.stockQuantity < 10">
                  {{ product.stockQuantity }} in stock
                </span>
              </div>
            </div>
            
            <div class="product-meta">
              <span class="category-tag" *ngIf="product.category">
                {{ product.category }}
              </span>
              <span class="sku" *ngIf="product.sku">
                SKU: {{ product.sku }}
              </span>
            </div>
          </mat-card-content>
          
          <mat-card-actions>
            <button mat-button (click)="toggleProductSelection(product)">
              <mat-icon>{{ isProductSelected(product) ? 'remove_shopping_cart' : 'add_shopping_cart' }}</mat-icon>
              {{ isProductSelected(product) ? 'Remove' : 'Add to Import' }}
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- Empty Products State -->
    <div class="empty-state" *ngIf="filteredProducts.length === 0">
      <div class="empty-icon">
        <mat-icon>inventory_2</mat-icon>
      </div>
      <h3>No products found</h3>
      <p *ngIf="products.length === 0">This shop has no available products.</p>
      <p *ngIf="products.length > 0">Try adjusting your search or filter criteria.</p>
      <button mat-button (click)="searchTerm = ''; selectedCategory = ''; applyFilters()" 
              *ngIf="products.length > 0">
        Clear Filters
      </button>
    </div>
  </div>
</div>
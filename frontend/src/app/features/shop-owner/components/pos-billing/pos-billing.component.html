<div class="pos-billing-container">
  <div class="pos-content">
    <!-- Left Panel: Tabs for Quick Bill / Browse -->
    <div class="products-panel">
      <!-- Tab Header with controls -->
      <div class="pos-tabs-row">
        <div class="pos-tabs">
          <button class="tab-btn" [class.active]="activeTab === 'quick'" (click)="activeTab = 'quick'">
            <mat-icon>bolt</mat-icon>
            <span>Quick Bill</span>
          </button>
          <button class="tab-btn" [class.active]="activeTab === 'browse'" (click)="activeTab = 'browse'; onPosModeChange()">
            <mat-icon>grid_view</mat-icon>
            <span>Browse Products</span>
          </button>
        </div>
        <!-- Controls: Language, Status, Sync -->
        <div class="pos-controls">
          <div class="language-toggle">
            <span class="lang-label" [class.active]="!showTamil">EN</span>
            <mat-slide-toggle [checked]="showTamil" (change)="toggleLanguage()" color="primary"></mat-slide-toggle>
            <span class="lang-label" [class.active]="showTamil">தமிழ்</span>
          </div>
          <div class="sync-status" [class.offline]="!syncStatus.isOnline" [class.online]="syncStatus.isOnline">
            <mat-icon>{{ syncStatus.isOnline ? 'cloud_done' : 'cloud_off' }}</mat-icon>
            <span class="sync-label">{{ syncStatus.isOnline ? 'Online' : 'Offline' }}</span>
          </div>
          <button mat-icon-button (click)="manualSync()" [disabled]="!syncStatus.isOnline || syncStatus.isSyncing" class="sync-btn" *ngIf="syncStatus.isOnline">
            <mat-icon [class.spinning]="syncStatus.isSyncing">sync</mat-icon>
          </button>
        </div>
      </div>

      <!-- Quick Bill Tab Content - Only show searched/scanned products -->
      <div class="tab-content" *ngIf="activeTab === 'quick'">
        <!-- Single Search/Scan Input -->
        <div class="quick-search-bar">
          <mat-icon class="search-icon">search</mat-icon>
          <input #searchInput
                 type="text"
                 [(ngModel)]="searchTerm"
                 (input)="onSearchChange()"
                 (keyup.enter)="onQuickSearchEnter()"
                 placeholder="Search or scan barcode..."
                 class="quick-search-input"
                 autofocus>
          <mat-icon class="barcode-icon">qr_code_scanner</mat-icon>
          <button *ngIf="searchTerm" mat-icon-button class="clear-btn" (click)="searchTerm = ''; onSearchChange()">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <!-- Empty State - Show when no search/scan AND no cart items -->
        <div class="quick-bill-empty" *ngIf="!searchTerm && cart.length === 0 && !isLoading">
          <mat-icon>qr_code_scanner</mat-icon>
          <h3>Scan or Search to Add Products</h3>
          <p>Search by name, SKU, or scan barcode to find products</p>
        </div>

        <!-- Cart Products Section - Show products in cart when not searching -->
        <div class="products-grid quick-bill-grid" *ngIf="!searchTerm && cart.length > 0 && !isLoading">
          <div class="section-header">
            <mat-icon>shopping_cart</mat-icon>
            <span>Products in Cart ({{ cart.length }})</span>
          </div>
          <div *ngFor="let product of getCartProducts()"
               class="product-card billing-card in-cart">
            <!-- In Cart Badge -->
            <div class="cart-badge">
              <span>{{ getCartQuantity(product) }}</span>
            </div>
            <div class="product-image" (click)="addToCart(product)">
              <img *ngIf="product.imageBase64 || product.image"
                   [src]="product.imageBase64 || getImageUrl(product.image)"
                   [alt]="product.name"
                   (error)="onImageError($event)">
              <div *ngIf="!product.image && !product.imageBase64" class="product-initial">{{ product.name[0] }}</div>
            </div>
            <div class="product-info">
              <div class="product-name">{{ getProductName(product) }}</div>
              <div class="product-sku" *ngIf="getDisplayBarcode(product)">{{ getDisplayBarcode(product) }}</div>
              <div class="product-tags" *ngIf="product.tags && product.tags.length > 0">
                <span class="tag" *ngFor="let tag of product.tags.slice(0, 1)">{{ tag }}</span>
              </div>
            </div>
            <!-- Editable Price & Quantity Section (for billing only, not saved) -->
            <div class="billing-controls">
              <div class="price-edit">
                <span class="price-label">₹</span>
                <input type="number"
                       class="price-input"
                       [value]="getTempPrice(product)"
                       (change)="setTempPrice(product, $event)"
                       (click)="$event.stopPropagation()"
                       min="0"
                       step="0.01">
              </div>
              <div class="qty-controls">
                <button class="qty-btn minus" (click)="decrementTempQty(product); $event.stopPropagation()">
                  <mat-icon>remove</mat-icon>
                </button>
                <span class="qty-value">{{ getTempQty(product) }}</span>
                <button class="qty-btn plus" (click)="incrementTempQty(product); $event.stopPropagation()">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <button class="add-btn" (click)="addToCartWithTempValues(product); $event.stopPropagation()"
                      [disabled]="getTempQty(product) === 0">
                <mat-icon>add_shopping_cart</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <!-- Search Results - Show when searching -->
        <div class="products-grid quick-bill-grid" *ngIf="searchTerm && !isLoading">
          <div *ngFor="let product of filteredProducts"
               class="product-card billing-card"
               [class.out-of-stock]="product.trackInventory && product.stock <= 0"
               [class.in-cart]="isInCart(product)">
            <!-- In Cart Badge -->
            <div class="cart-badge" *ngIf="getCartQuantity(product) > 0">
              <span>{{ getCartQuantity(product) }}</span>
            </div>
            <div class="product-image" (click)="addToCart(product)">
              <img *ngIf="product.imageBase64 || product.image"
                   [src]="product.imageBase64 || getImageUrl(product.image)"
                   [alt]="product.name"
                   (error)="onImageError($event)">
              <div *ngIf="!product.image && !product.imageBase64" class="product-initial">{{ product.name[0] }}</div>
            </div>
            <div class="product-info">
              <div class="product-name">{{ getProductName(product) }}</div>
              <div class="product-sku" *ngIf="getDisplayBarcode(product)">{{ getDisplayBarcode(product) }}</div>
              <div class="product-tags" *ngIf="product.tags && product.tags.length > 0">
                <span class="tag" *ngFor="let tag of product.tags.slice(0, 1)">{{ tag }}</span>
              </div>
            </div>
            <!-- Editable Price & Quantity Section (for billing only, not saved) -->
            <div class="billing-controls">
              <div class="price-edit">
                <span class="price-label">₹</span>
                <input type="number"
                       class="price-input"
                       [value]="getTempPrice(product)"
                       (change)="setTempPrice(product, $event)"
                       (click)="$event.stopPropagation()"
                       min="0"
                       step="0.01">
              </div>
              <div class="qty-controls">
                <button class="qty-btn minus" (click)="decrementTempQty(product); $event.stopPropagation()">
                  <mat-icon>remove</mat-icon>
                </button>
                <span class="qty-value">{{ getTempQty(product) }}</span>
                <button class="qty-btn plus" (click)="incrementTempQty(product); $event.stopPropagation()">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
              <button class="add-btn" (click)="addToCartWithTempValues(product); $event.stopPropagation()"
                      [disabled]="getTempQty(product) === 0">
                <mat-icon>add_shopping_cart</mat-icon>
              </button>
            </div>
          </div>

          <!-- No Results -->
          <div *ngIf="filteredProducts.length === 0" class="empty-products">
            <mat-icon>search_off</mat-icon>
            <p>No products found for "{{ searchTerm }}"</p>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading products...</p>
        </div>
      </div>

      <!-- Browse Tab Content -->
      <div class="tab-content" *ngIf="activeTab === 'browse'">
        <!-- Search Section for Browse -->
        <div class="search-section">
          <div class="search-row">
            <div class="search-box">
              <mat-icon>search</mat-icon>
              <input type="text"
                     [(ngModel)]="searchTerm"
                     (input)="onSearchChange()"
                     placeholder="Search products by name, SKU, or barcode..."
                     class="search-input">
              <button *ngIf="searchTerm" mat-icon-button (click)="searchTerm = ''; onSearchChange()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="barcode-box">
              <mat-icon>qr_code_scanner</mat-icon>
              <input type="text"
                     [(ngModel)]="barcodeBuffer"
                     (keyup.enter)="onBarcodeSubmit()"
                     placeholder="Scan barcode..."
                     class="barcode-input">
            </div>
          </div>
        </div>

        <!-- Products Grid -->
        <div class="products-grid" *ngIf="!isLoading">
          <div *ngFor="let product of filteredProducts"
               class="product-card"
               [class.out-of-stock]="product.trackInventory && product.stock <= 0"
               [class.in-cart]="isInCart(product)"
               (click)="addToCart(product)">
            <!-- In Cart Badge -->
            <div class="cart-badge" *ngIf="getCartQuantity(product) > 0">
              <span>{{ getCartQuantity(product) }}</span>
            </div>
            <!-- Quick Edit Button -->
            <button class="quick-edit-btn" (click)="openQuickEdit(product, $event)" title="Edit Price/Stock">
              <mat-icon>edit</mat-icon>
            </button>
            <div class="product-image">
              <img *ngIf="product.imageBase64 || product.image"
                   [src]="product.imageBase64 || getImageUrl(product.image)"
                   [alt]="product.name"
                   (error)="onImageError($event)">
              <div *ngIf="!product.image && !product.imageBase64" class="product-initial">{{ product.name[0] }}</div>
            </div>
            <div class="product-info">
              <div class="product-name">{{ getProductName(product) }}</div>
              <div class="product-name-secondary" *ngIf="showTamil && product.name">{{ product.name }}</div>
              <div class="product-name-secondary" *ngIf="!showTamil && product.nameTamil">{{ product.nameTamil }}</div>
              <div class="product-sku" *ngIf="getDisplayBarcode(product)">{{ getDisplayBarcode(product) }}</div>
              <div class="product-price">₹{{ product.price }}</div>
              <div class="product-stock" *ngIf="product.trackInventory">
                <span [class.low-stock]="product.stock <= 5">Stock: {{ product.stock }}</span>
              </div>
              <div class="product-tags" *ngIf="product.tags && product.tags.length > 0">
                <span class="tag" *ngFor="let tag of product.tags.slice(0, 2)">{{ tag }}</span>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div *ngIf="filteredProducts.length === 0" class="empty-products">
            <mat-icon>inventory_2</mat-icon>
            <p>No products found</p>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading products...</p>
        </div>
      </div>
    </div>

    <!-- Right Panel: Cart & Billing -->
    <div class="cart-panel">
      <!-- Cart Header -->
      <div class="cart-header">
        <h2>
          <mat-icon>shopping_cart</mat-icon>
          Cart ({{ cart.length }})
        </h2>
        <button mat-icon-button color="warn" (click)="clearCart()" *ngIf="cart.length > 0" title="Clear Cart">
          <mat-icon>delete_sweep</mat-icon>
        </button>
      </div>
      <!-- Cart Items -->
      <div class="cart-items">
        <div *ngFor="let item of cart" class="cart-item">
          <div class="item-row-top">
            <div class="item-name">{{ getProductName(item.product) }}</div>
            <button mat-icon-button color="warn" (click)="removeFromCart(item)" class="remove-btn">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="item-row-bottom">
            <div class="item-price-section">
              <span class="item-mrp" *ngIf="item.discount > 0">₹{{ item.mrp }}</span>
              <span class="item-price">₹{{ item.unitPrice }} x</span>
            </div>
            <div class="item-quantity">
              <button mat-mini-fab color="basic" (click)="updateQuantity(item, -1)">
                <mat-icon>remove</mat-icon>
              </button>
              <span class="qty">{{ item.quantity }}</span>
              <button mat-mini-fab color="basic" (click)="updateQuantity(item, 1)">
                <mat-icon>add</mat-icon>
              </button>
            </div>
            <div class="item-total-section">
              <span class="item-total">₹{{ item.total }}</span>
              <span class="item-discount" *ngIf="item.discount > 0">Save ₹{{ item.discount * item.quantity }}</span>
            </div>
          </div>
        </div>

        <!-- Empty Cart -->
        <div *ngIf="cart.length === 0" class="empty-cart">
          <mat-icon>shopping_cart</mat-icon>
          <p>Cart is empty</p>
          <span>Add products to start billing</span>
        </div>
      </div>

      <!-- Cart Footer - fixed at bottom -->
      <div class="cart-footer">
        <!-- Customer Info (Collapsible) -->
        <div class="customer-section">
          <button mat-button (click)="toggleCustomerForm()" class="customer-toggle">
            <mat-icon>{{ showCustomerForm ? 'expand_less' : 'expand_more' }}</mat-icon>
            Customer Details (Optional)
          </button>
          <div *ngIf="showCustomerForm" class="customer-form">
            <input type="text" [(ngModel)]="customerName" placeholder="Customer Name" class="customer-input">
            <input type="tel" [(ngModel)]="customerPhone" placeholder="Phone Number" class="customer-input">
            <input type="text" [(ngModel)]="orderNotes" placeholder="Notes" class="customer-input">
          </div>
        </div>

        <!-- Totals -->
        <div class="totals-section" *ngIf="cart.length > 0">
          <div class="total-row mrp-total" *ngIf="totalDiscount > 0">
            <span>MRP Total</span>
            <span class="mrp-value">₹{{ totalMrp | number:'1.0-0' }}</span>
          </div>
          <div class="total-row discount-total" *ngIf="totalDiscount > 0">
            <span>Discount</span>
            <span class="discount-value">- ₹{{ totalDiscount | number:'1.0-0' }}</span>
          </div>
          <div class="total-row grand-total">
            <span>TOTAL</span>
            <span>₹{{ totalAmount | number:'1.0-0' }}</span>
          </div>
        </div>

        <!-- Payment Methods -->
        <div class="payment-section" *ngIf="cart.length > 0">
          <div class="payment-label">Payment Method</div>
          <div class="payment-options">
            <button *ngFor="let method of paymentMethods"
                    mat-stroked-button
                    [class.selected]="selectedPaymentMethod === method.value"
                    (click)="selectedPaymentMethod = method.value">
              {{ method.label }}
            </button>
          </div>
        </div>

        <!-- Generate Bill Button -->
        <button mat-raised-button
                color="primary"
                class="generate-btn"
                [disabled]="cart.length === 0"
                (click)="generateBill()">
          <mat-icon>receipt_long</mat-icon>
          Generate Bill - ₹{{ totalAmount | number:'1.0-0' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Floating Action Buttons -->
  <div class="fab-container">
    <button class="quick-add-fab add-product-fab" (click)="openAddProductDialog()" title="Add New Product (Offline)">
      <mat-icon>add_box</mat-icon>
    </button>
    <button class="quick-add-fab" (click)="openQuickAdd()" title="Quick Add (One-time)">
      <mat-icon>add</mat-icon>
    </button>
  </div>

  <!-- Quick Edit Dialog - Compact Modern Design -->
  <div class="quick-edit-overlay" *ngIf="editingProduct" (click)="closeQuickEdit()">
    <div class="quick-edit-dialog compact-dialog" (click)="$event.stopPropagation()">
      <!-- Header with product info -->
      <div class="dialog-header compact-header">
        <div class="header-product-info">
          <div class="header-image" *ngIf="editingProduct.imageBase64 || editingProduct.image">
            <img [src]="editingProduct.imageBase64 || getImageUrl(editingProduct.image)" [alt]="editingProduct.name">
          </div>
          <div class="header-text">
            <h3>{{ editingProduct.name }}</h3>
            <span class="sku-badge">{{ editingProduct.sku || editingProduct.barcode1 || 'No SKU' }}</span>
          </div>
        </div>
        <button mat-icon-button (click)="closeQuickEdit()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="dialog-content compact-content">
        <!-- Product Names Section -->
        <div class="names-section">
          <div class="name-field">
            <label>
              <mat-icon>translate</mat-icon>
              English Name
            </label>
            <input type="text" [(ngModel)]="editName" placeholder="Product name in English" class="name-input">
          </div>
          <div class="name-field">
            <label>
              <mat-icon>language</mat-icon>
              Tamil Name (தமிழ்)
            </label>
            <input type="text" [(ngModel)]="editNameTamil" placeholder="பொருளின் பெயர்" class="name-input tamil-input">
          </div>
        </div>

        <!-- Image Section -->
        <div class="image-section">
          <div class="current-image">
            <label>Product Image</label>
            <div class="image-preview-container">
              <!-- Show new preview if selected, otherwise show current image -->
              <img *ngIf="editImagePreview" [src]="editImagePreview" alt="New image preview" class="preview-img">
              <img *ngIf="!editImagePreview && (editingProduct?.imageBase64 || editingProduct?.image)"
                   [src]="editingProduct?.imageBase64 || getImageUrl(editingProduct?.image)"
                   alt="Current image" class="preview-img">
              <div *ngIf="!editImagePreview && !editingProduct?.imageBase64 && !editingProduct?.image" class="no-image">
                <mat-icon>image</mat-icon>
                <span>No image</span>
              </div>
              <!-- Remove new image button -->
              <button *ngIf="editImagePreview" class="remove-image-btn" (click)="removeEditImage()" title="Remove new image">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
          <div class="image-upload">
            <input type="file" #imageInput accept="image/*" (change)="onEditImageSelect($event)" style="display: none;">
            <button class="upload-btn" (click)="imageInput.click()">
              <mat-icon>add_photo_alternate</mat-icon>
              {{ editImagePreview ? 'Change Image' : 'Upload Image' }}
            </button>
            <span class="upload-hint">Max 5MB, JPG/PNG</span>
          </div>
        </div>

        <!-- Two Column Layout -->
        <div class="two-column-grid">
          <!-- Left Column: Pricing -->
          <div class="edit-card">
            <div class="card-title">
              <mat-icon>sell</mat-icon>
              Pricing
            </div>
            <div class="card-fields">
              <div class="inline-field">
                <label>Price</label>
                <div class="input-with-prefix">
                  <span class="prefix">₹</span>
                  <input type="number" [(ngModel)]="editPrice" min="0" step="0.01">
                </div>
              </div>
              <div class="inline-field">
                <label>MRP</label>
                <div class="input-with-prefix">
                  <span class="prefix">₹</span>
                  <input type="number" [(ngModel)]="editMrp" min="0" step="0.01">
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Stock & Label Info -->
          <div class="edit-card">
            <div class="card-title">
              <mat-icon>inventory_2</mat-icon>
              Stock & Label
            </div>
            <div class="card-fields">
              <div class="inline-field">
                <label>Stock</label>
                <input type="number" [(ngModel)]="editStock" min="0" step="1" class="stock-input">
              </div>
              <div class="inline-field">
                <label>Net Qty</label>
                <input type="text" [(ngModel)]="labelNetQty" placeholder="250g" class="label-input">
              </div>
              <div class="inline-field">
                <label>PKD</label>
                <input type="text" [ngModel]="labelPackedDate" (input)="formatDateInput($event, 'pkd')" placeholder="MM/YY" class="label-input" maxlength="5">
              </div>
              <div class="inline-field">
                <label>EXP</label>
                <input type="text" [ngModel]="labelExpiryDate" (input)="formatDateInput($event, 'exp')" placeholder="MM/YY" class="label-input" maxlength="5">
              </div>
            </div>
          </div>
        </div>

        <!-- SKU & Barcodes Section -->
        <div class="barcode-section">
          <div class="barcode-header">
            <mat-icon>qr_code_scanner</mat-icon>
            <span>SKU & Barcodes</span>
          </div>
          <div class="barcode-grid">
            <div class="barcode-field">
              <label>SKU ID</label>
              <input type="text"
                     [(ngModel)]="editSku"
                     placeholder="SKU identifier"
                     class="barcode-input-field"
                     autocomplete="off">
            </div>
            <div class="barcode-field">
              <label>Barcode 1 (Primary)</label>
              <input type="text"
                     [(ngModel)]="editBarcode1"
                     placeholder="Primary barcode"
                     class="barcode-input-field"
                     autocomplete="off">
            </div>
            <div class="barcode-field">
              <label>Barcode 2</label>
              <input type="text"
                     [(ngModel)]="editBarcode2"
                     placeholder="Secondary barcode"
                     class="barcode-input-field"
                     autocomplete="off">
            </div>
            <div class="barcode-field">
              <label>Barcode 3</label>
              <input type="text"
                     [(ngModel)]="editBarcode3"
                     placeholder="Tertiary barcode"
                     class="barcode-input-field"
                     autocomplete="off">
            </div>
          </div>
        </div>

        <!-- Print Label Row -->
        <div class="print-label-inline">
          <div class="print-left">
            <mat-icon>print</mat-icon>
            <span>Print Labels</span>
            <button class="label-config-btn" (click)="showLabelConfigDialog = true" title="Label Settings">
              <mat-icon>settings</mat-icon>
            </button>
          </div>
          <div class="print-right">
            <input type="number" [(ngModel)]="labelQuantity" min="1" max="100" class="qty-input">
            <button class="print-btn" (click)="printLabel()">
              <mat-icon>print</mat-icon>
              Print
            </button>
          </div>
        </div>
      </div>

      <div class="dialog-actions compact-actions">
        <button mat-stroked-button (click)="closeQuickEdit()">Cancel</button>
        <button mat-raised-button color="primary" (click)="saveQuickEdit()" [disabled]="isSavingEdit">
          <mat-spinner *ngIf="isSavingEdit" diameter="16"></mat-spinner>
          <span *ngIf="!isSavingEdit">Save</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Quick Add Custom Product Dialog -->
  <div class="quick-edit-overlay" *ngIf="showQuickAddDialog" (click)="closeQuickAdd()">
    <div class="quick-edit-dialog quick-add-dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3>Add Custom Product</h3>
        <button mat-icon-button (click)="closeQuickAdd()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="dialog-content">
        <div class="edit-fields">
          <div class="field-group">
            <label>Product Name *</label>
            <input type="text" [(ngModel)]="customProductName" placeholder="Enter product name" class="edit-input">
          </div>
          <div class="field-group">
            <label>Selling Price (₹) *</label>
            <input type="number" [(ngModel)]="customProductPrice" min="0" step="0.01" placeholder="0" class="edit-input">
          </div>
          <div class="field-group">
            <label>MRP (₹)</label>
            <input type="number" [(ngModel)]="customProductMrp" min="0" step="0.01" placeholder="Same as price" class="edit-input">
          </div>
          <div class="field-group">
            <label>Quantity</label>
            <input type="number" [(ngModel)]="customProductQty" min="1" step="1" placeholder="1" class="edit-input">
          </div>
        </div>
        <p class="custom-product-note">
          <mat-icon>info</mat-icon>
          Custom products are for one-time billing only and won't be saved to inventory.
        </p>
      </div>
      <div class="dialog-actions">
        <button mat-stroked-button (click)="closeQuickAdd()">Cancel</button>
        <button mat-raised-button color="primary" (click)="addCustomProduct()"
                [disabled]="!customProductName || !customProductPrice || customProductPrice <= 0">
          <mat-icon>add_shopping_cart</mat-icon>
          Add to Cart
        </button>
      </div>
    </div>
  </div>

  <!-- Add New Product Dialog (Offline Capable) -->
  <div class="quick-edit-overlay" *ngIf="showAddProductDialog" (click)="closeAddProductDialog()">
    <div class="quick-edit-dialog add-product-dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h3>
          <mat-icon>add_box</mat-icon>
          Add New Product
          <span class="offline-badge" *ngIf="!syncStatus.isOnline">(Offline)</span>
        </h3>
        <button mat-icon-button (click)="closeAddProductDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div class="dialog-content">
        <div class="edit-fields">
          <!-- Product Names Row -->
          <div class="field-row two-cols">
            <div class="field-group">
              <label>Product Name (English) *</label>
              <input type="text" [(ngModel)]="newProductName" placeholder="Enter product name" class="edit-input" required>
            </div>
            <div class="field-group">
              <label>Tamil Name (தமிழ் பெயர்)</label>
              <input type="text" [(ngModel)]="newProductNameTamil" placeholder="பொருளின் பெயர்" class="edit-input tamil-input">
            </div>
          </div>

          <!-- Price, MRP, Stock in one row -->
          <div class="field-row three-cols">
            <div class="field-group">
              <label>Selling Price (₹) *</label>
              <input type="number" [(ngModel)]="newProductPrice" min="0" step="0.01" placeholder="0" class="edit-input" required>
            </div>
            <div class="field-group">
              <label>MRP (₹)</label>
              <input type="number" [(ngModel)]="newProductMrp" min="0" step="0.01" placeholder="Same as price" class="edit-input">
            </div>
            <div class="field-group">
              <label>Stock Quantity</label>
              <input type="number" [(ngModel)]="newProductStock" min="0" step="1" placeholder="0" class="edit-input">
            </div>
          </div>

          <!-- Barcodes in one row -->
          <div class="field-row three-cols">
            <div class="field-group">
              <label>Barcode 1</label>
              <input type="text" [(ngModel)]="newProductBarcode1" placeholder="Primary barcode" class="edit-input">
            </div>
            <div class="field-group">
              <label>Barcode 2</label>
              <input type="text" [(ngModel)]="newProductBarcode2" placeholder="Secondary barcode" class="edit-input">
            </div>
            <div class="field-group">
              <label>Barcode 3</label>
              <input type="text" [(ngModel)]="newProductBarcode3" placeholder="Tertiary barcode" class="edit-input">
            </div>
          </div>

          <!-- Track Inventory Toggle -->
          <div class="field-group toggle-group">
            <mat-slide-toggle [(ngModel)]="newProductTrackInventory" color="primary">
              Track Inventory
            </mat-slide-toggle>
          </div>
        </div>

        <p class="product-note">
          <mat-icon>info</mat-icon>
          <span *ngIf="syncStatus.isOnline">Product will be created in your shop inventory.</span>
          <span *ngIf="!syncStatus.isOnline">Product will be saved locally and synced when online.</span>
        </p>
      </div>
      <div class="dialog-actions">
        <button mat-stroked-button (click)="closeAddProductDialog()">Cancel</button>
        <button mat-raised-button color="primary" (click)="saveNewProduct()"
                [disabled]="!newProductName || !newProductPrice || newProductPrice <= 0 || isSavingNewProduct">
          <mat-spinner *ngIf="isSavingNewProduct" diameter="18"></mat-spinner>
          <mat-icon *ngIf="!isSavingNewProduct">save</mat-icon>
          <span *ngIf="!isSavingNewProduct">Save Product</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Label Configuration Dialog -->
  <div class="label-config-overlay" *ngIf="showLabelConfigDialog" (click)="showLabelConfigDialog = false">
    <div class="label-config-dialog" (click)="$event.stopPropagation()">
      <div class="config-header">
        <h3>
          <mat-icon>tune</mat-icon>
          Label Settings
        </h3>
        <button mat-icon-button (click)="showLabelConfigDialog = false">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="config-content">
        <!-- Label Data Fields - at top for easy access -->
        <div class="config-section">
          <div class="section-title">Label Data</div>

          <div class="config-field">
            <label>Net Qty</label>
            <input type="text" [(ngModel)]="labelNetQty" placeholder="e.g. 250g, 1kg">
          </div>
          <div class="config-field-row">
            <div class="config-field">
              <label>PKD (Packed)</label>
              <input type="text" [(ngModel)]="labelPackedDate" placeholder="MM/YY">
            </div>
            <div class="config-field">
              <label>EXP (Expiry)</label>
              <input type="text" [(ngModel)]="labelExpiryDate" placeholder="MM/YY">
            </div>
          </div>
        </div>

        <!-- Toggle switches section -->
        <div class="config-section">
          <div class="section-title">Show/Hide Elements</div>

          <div class="config-item">
            <span>Shop Name</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showShopName" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Tamil Name</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showTamilName" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>English Name</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showEnglishName" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Net Quantity</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showNetQty" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>MRP</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showMrp" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Packed Date (PKD)</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showPackedDate" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Expiry Date (EXP)</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showExpiryDate" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Barcode</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showBarcode" color="primary"></mat-slide-toggle>
          </div>
          <div class="config-item">
            <span>Barcode Number</span>
            <mat-slide-toggle [(ngModel)]="labelConfig.showBarcodeNumber" color="primary"></mat-slide-toggle>
          </div>
        </div>
      </div>

      <div class="config-actions">
        <button mat-stroked-button (click)="showLabelConfigDialog = false">Cancel</button>
        <button mat-raised-button color="primary" (click)="saveLabelConfig()">
          <mat-icon>save</mat-icon>
          Save Settings
        </button>
      </div>
    </div>
  </div>
</div>

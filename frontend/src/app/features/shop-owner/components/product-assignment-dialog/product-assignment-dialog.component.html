<div class="assignment-dialog-container">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>add_business</mat-icon>
      Add to Shop
    </h2>
    <button mat-icon-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- Product Info -->
    <div class="product-preview">
      <div class="product-image">
        <img [src]="data.product.primaryImageUrl || '/assets/images/product-placeholder.svg'"
             [alt]="data.product.name"
             onerror="this.src='/assets/images/product-placeholder.svg'">
      </div>
      <div class="product-info">
        <h3>{{ data.product.name }}</h3>
        <div class="product-meta">
          <span class="meta-item" *ngIf="data.product.category?.name">
            <mat-icon>category</mat-icon>
            {{ data.product.category?.name }}
          </span>
        </div>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="assignmentForm" class="assignment-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Selling Price (₹) *</mat-label>
          <input matInput type="number" formControlName="price" placeholder="0.00">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>MRP (₹)</mat-label>
          <input matInput type="number" formControlName="originalPrice" placeholder="Optional">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Stock Qty</mat-label>
          <input matInput type="number" formControlName="stockQuantity" placeholder="0">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Cost Price (₹)</mat-label>
          <input matInput type="number" formControlName="costPrice" placeholder="Optional">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>SKU *</mat-label>
          <input matInput formControlName="sku" placeholder="Product SKU">
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Barcode</mat-label>
          <input matInput formControlName="barcode1" placeholder="Optional">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Custom Name</mat-label>
          <input matInput formControlName="customName" placeholder="Override product name (optional)">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tamil Name</mat-label>
          <input matInput formControlName="nameTamil" placeholder="தமிழ் பெயர் (optional)">
        </mat-form-field>
      </div>

      <div class="form-row">
        <div class="availability-toggle">
          <mat-slide-toggle formControlName="isAvailable" color="primary">
            {{ assignmentForm.get('isAvailable')?.value ? 'Available' : 'Hidden' }}
          </mat-slide-toggle>
        </div>
      </div>

      <!-- Profit Preview -->
      <div class="profit-preview" *ngIf="assignmentForm.get('price')?.value && assignmentForm.get('costPrice')?.value">
        <mat-card class="profit-card">
          <div class="profit-info">
            <span class="profit-label">Profit:</span>
            <span class="profit-value" [class.positive]="getProfit() > 0" [class.negative]="getProfit() < 0">
              ₹{{ getProfit() | number:'1.0-0' }} ({{ getProfitPercentage() | number:'1.0-0' }}%)
            </span>
          </div>
        </mat-card>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-stroked-button mat-dialog-close>Cancel</button>
    <button mat-raised-button
            color="primary"
            [disabled]="assignmentForm.invalid || isLoading"
            (click)="assignProduct()">
      <mat-icon *ngIf="!isLoading">add</mat-icon>
      <mat-progress-spinner *ngIf="isLoading" diameter="18" mode="indeterminate"></mat-progress-spinner>
      {{ isLoading ? 'Adding...' : 'Add to Shop' }}
    </button>
  </mat-dialog-actions>
</div>

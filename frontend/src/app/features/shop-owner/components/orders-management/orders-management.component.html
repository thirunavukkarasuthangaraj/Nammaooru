<div class="orders-page">
  <!-- Simple Header -->
  <div class="page-header">
    <h1>Orders</h1>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="setTestToken(); loadDashboardData()">
        Refresh Orders
      </button>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats">
    <div class="stat">
      <span class="number">{{ totalOrders }}</span>
      <span class="label">Total</span>
    </div>
    <div class="stat">
      <span class="number">{{ pendingOrders.length }}</span>
      <span class="label">Pending</span>
    </div>
    <div class="stat">
      <span class="number">{{ activeOrders.length }}</span>
      <span class="label">Active</span>
    </div>
    <div class="stat">
      <span class="number">{{ completedOrders.length }}</span>
      <span class="label">Done</span>
    </div>
    <div class="stat">
      <span class="number">₹{{ todayRevenue | number:'1.0-0' }}</span>
      <span class="label">Revenue</span>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <input type="text"
           placeholder="Search orders..."
           [(ngModel)]="searchTerm"
           (input)="applyFilter()"
           class="search-input">

    <select [(ngModel)]="selectedStatus" (change)="applyFilter()" class="status-filter">
      <option value="">All Status</option>
      <option value="PENDING">Pending</option>
      <option value="CONFIRMED">Confirmed</option>
      <option value="PREPARING">Preparing</option>
      <option value="READY_FOR_PICKUP">Ready</option>
      <option value="DELIVERED">Delivered</option>
    </select>
  </div>

  <!-- Orders Table -->
  <div class="orders-container">
    <div class="orders-header">
      <div class="col-order">Order</div>
      <div class="col-customer">Customer</div>
      <div class="col-items">Items</div>
      <div class="col-amount">Amount</div>
      <div class="col-status">Status</div>
      <div class="col-actions">Actions</div>
    </div>

    <div class="orders-list">
      <div *ngFor="let order of filteredOrders" class="order-row" [ngClass]="'status-' + order.status.toLowerCase()">

        <!-- Order Info -->
        <div class="col-order">
          <div class="order-id">{{ order.orderNumber }}</div>
          <div class="order-time">{{ order.createdAt | date:'MMM d, HH:mm' }}</div>
        </div>

        <!-- Customer Info -->
        <div class="col-customer">
          <div class="customer-name">{{ order.customerName }}</div>
          <div class="customer-phone" *ngIf="order.customerPhone">{{ order.customerPhone }}</div>
        </div>

        <!-- Items -->
        <div class="col-items">
          <div class="items-list">
            <span *ngFor="let item of order.items; let last = last">
              {{ item.quantity }}x {{ item.name || item.productName }}{{ !last ? ', ' : '' }}
            </span>
          </div>
        </div>

        <!-- Amount -->
        <div class="col-amount">
          <div class="amount">₹{{ order.totalAmount | number:'1.0-0' }}</div>
          <div class="payment-method">{{ order.paymentMethod === 'CASH_ON_DELIVERY' ? 'COD' : 'Paid' }}</div>
        </div>

        <!-- Status -->
        <div class="col-status">
          <span class="status-badge" [ngClass]="getStatusClass(order.status)">
            {{ getStatusLabel(order.status) }}
          </span>
        </div>

        <!-- Actions -->
        <div class="col-actions">
          <div class="action-buttons">

            <!-- Pending Actions -->
            <ng-container *ngIf="order.status === 'PENDING'">
              <button class="btn btn-accept" (click)="acceptOrder(order)">Accept</button>
              <button class="btn btn-reject" (click)="rejectOrder(order)">Reject</button>
            </ng-container>

            <!-- Confirmed Actions -->
            <ng-container *ngIf="order.status === 'CONFIRMED'">
              <button class="btn btn-prepare" (click)="startPreparing(order.id)">Start Prep</button>
            </ng-container>

            <!-- Preparing Actions -->
            <ng-container *ngIf="order.status === 'PREPARING'">
              <button class="btn btn-ready" (click)="markReady(order.id)">Mark Ready</button>
            </ng-container>

            <!-- Ready Actions -->
            <ng-container *ngIf="order.status === 'READY_FOR_PICKUP'">
              <button class="btn btn-assign" (click)="assignDelivery(order.id)">Assign Delivery</button>
            </ng-container>

            <!-- Always available actions -->
            <button class="btn btn-details" (click)="viewOrderDetails(order)" title="View Details">⋯</button>

          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredOrders.length === 0" class="empty-state">
      <p>No orders found</p>
      <p class="empty-subtitle" *ngIf="searchTerm">Try adjusting your search terms</p>
    </div>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>
</div>
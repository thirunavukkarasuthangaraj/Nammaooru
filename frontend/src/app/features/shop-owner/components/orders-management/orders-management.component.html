<div class="orders-management chennai-page">
  <div class="page-header">
    <h1>Orders Management</h1>
    <div class="header-stats">
      <mat-chip-set>
        <mat-chip color="primary">{{ pendingOrders.length }} Pending</mat-chip>
        <mat-chip color="accent">{{ processingOrders.length }} Processing</mat-chip>
        <mat-chip>{{ todayOrders.length }} Today</mat-chip>
      </mat-chip-set>
    </div>
  </div>

  <div class="orders-tabs">
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" (selectedTabChange)="onTabChange($event)">
      <mat-tab label="All Orders">
        <div class="tab-content">
          <div class="filters-section">
            <mat-form-field>
              <mat-label>Search Orders</mat-label>
              <input matInput [(ngModel)]="searchTerm" (ngModelChange)="applyFilter()">
              <mat-icon matSuffix>search</mat-icon>
            </mat-form-field>
            
            <mat-form-field>
              <mat-label>Status</mat-label>
              <mat-select [(ngModel)]="selectedStatus" (selectionChange)="applyFilter()">
                <mat-option value="">All Status</mat-option>
                <mat-option value="pending">Pending</mat-option>
                <mat-option value="accepted">Accepted</mat-option>
                <mat-option value="preparing">Preparing</mat-option>
                <mat-option value="ready">Ready</mat-option>
                <mat-option value="picked_up">Picked Up</mat-option>
                <mat-option value="delivered">Delivered</mat-option>
                <mat-option value="cancelled">Cancelled</mat-option>
              </mat-select>
            </mat-form-field>
            
            <mat-form-field>
              <mat-label>Date Range</mat-label>
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate [(ngModel)]="startDate" placeholder="Start date">
                <input matEndDate [(ngModel)]="endDate" placeholder="End date">
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </div>
          
          <div class="orders-list">
            <mat-card *ngFor="let order of filteredOrders" class="order-card">
              <div class="order-header">
                <div class="order-info">
                  <h3>Order #{{ order.orderNumber }}</h3>
                  <div class="order-meta">
                    <span class="customer">{{ order.customerName }}</span>
                    <span class="separator">•</span>
                    <span class="date">{{ order.createdAt | date:'medium' }}</span>
                  </div>
                </div>
                <div class="order-status">
                  <mat-chip [color]="getStatusColor(order.status)">
                    {{ order.status | titlecase }}
                  </mat-chip>
                  <span class="amount">₹{{ order.totalAmount | number }}</span>
                </div>
              </div>
              
              <div class="order-items">
                <div *ngFor="let item of order.items" class="order-item">
                  <img [src]="item.image || 'assets/images/placeholder-product.jpg'" [alt]="item.name">
                  <div class="item-details">
                    <span class="item-name">{{ item.name }}</span>
                    <span class="item-quantity">Qty: {{ item.quantity }}</span>
                  </div>
                  <span class="item-price">₹{{ item.price * item.quantity | number }}</span>
                </div>
              </div>
              
              <div class="order-actions">
                <ng-container [ngSwitch]="order.status">
                  <div *ngSwitchCase="'pending'" class="pending-actions">
                    <button mat-raised-button color="primary" (click)="acceptOrder(order.id)">
                      <mat-icon>check</mat-icon> Accept Order
                    </button>
                    <button mat-stroked-button color="warn" (click)="rejectOrder(order.id)">
                      <mat-icon>close</mat-icon> Reject
                    </button>
                  </div>
                  
                  <div *ngSwitchCase="'accepted'" class="accepted-actions">
                    <button mat-raised-button color="primary" (click)="startPreparing(order.id)">
                      <mat-icon>restaurant</mat-icon> Start Preparing
                    </button>
                  </div>
                  
                  <div *ngSwitchCase="'preparing'" class="preparing-actions">
                    <button mat-raised-button color="primary" (click)="markReady(order.id)">
                      <mat-icon>done</mat-icon> Mark Ready
                    </button>
                  </div>
                  
                  <div *ngSwitchCase="'ready'" class="ready-actions">
                    <button mat-raised-button color="primary" (click)="markPickedUp(order.id)">
                      <mat-icon>local_shipping</mat-icon> Mark Picked Up
                    </button>
                  </div>
                  
                  <div *ngSwitchDefault class="default-actions">
                    <button mat-button (click)="viewOrderDetails(order.id)">
                      <mat-icon>visibility</mat-icon> View Details
                    </button>
                  </div>
                </ng-container>
                
                <button mat-button (click)="printOrder(order.id)">
                  <mat-icon>print</mat-icon> Print
                </button>
                
                <button mat-icon-button [matMenuTriggerFor]="orderMenu">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #orderMenu="matMenu">
                  <button mat-menu-item (click)="viewCustomer(order.customerId)">
                    <mat-icon>person</mat-icon> View Customer
                  </button>
                  <button mat-menu-item (click)="refundOrder(order.id)" 
                          *ngIf="order.status === 'DELIVERED'">
                    <mat-icon>undo</mat-icon> Process Refund
                  </button>
                  <button mat-menu-item (click)="reportIssue(order.id)">
                    <mat-icon>report</mat-icon> Report Issue
                  </button>
                </mat-menu>
              </div>
            </mat-card>
          </div>
          
          <mat-paginator [length]="totalOrders" 
                         [pageSize]="pageSize" 
                         [pageSizeOptions]="[10, 25, 50]"
                         (page)="onPageChange($event)">
          </mat-paginator>
        </div>
      </mat-tab>
      
      <mat-tab label="Pending Orders">
        <div class="tab-content">
          <div class="pending-orders-grid">
            <mat-card *ngFor="let order of pendingOrders" class="pending-order-card">
              <div class="urgent-indicator" *ngIf="isUrgent(order.createdAt)">
                <mat-icon>warning</mat-icon> URGENT
              </div>
              
              <div class="order-summary">
                <h3>Order #{{ order.orderNumber }}</h3>
                <p>{{ order.customerName }} • {{ order.items.length }} items</p>
                <span class="amount">₹{{ order.totalAmount | number }}</span>
                <span class="time-ago">{{ getTimeAgo(order.createdAt) }}</span>
              </div>
              
              <div class="quick-actions">
                <button mat-raised-button color="primary" (click)="quickAccept(order.id)">
                  Accept
                </button>
                <button mat-stroked-button color="warn" (click)="quickReject(order.id)">
                  Reject
                </button>
              </div>
            </mat-card>
          </div>
        </div>
      </mat-tab>
      
      <mat-tab label="In Progress">
        <div class="tab-content">
          <div class="progress-timeline">
            <div *ngFor="let order of inProgressOrders" class="timeline-item">
              <div class="timeline-indicator" [ngClass]="order.status"></div>
              <div class="timeline-content">
                <mat-card class="progress-card">
                  <div class="progress-header">
                    <h3>Order #{{ order.orderNumber }}</h3>
                    <mat-chip [color]="getStatusColor(order.status)">
                      {{ order.status | titlecase }}
                    </mat-chip>
                  </div>
                  
                  <div class="progress-info">
                    <p>{{ order.customerName }} • {{ order.items.length }} items • ₹{{ order.totalAmount | number }}</p>
                    <div class="estimated-time">
                      <mat-icon>schedule</mat-icon>
                      <span>Est. {{ getEstimatedTime(order.status) }} min</span>
                    </div>
                  </div>
                  
                  <div class="progress-actions">
                    <button mat-raised-button color="primary" (click)="moveToNextStage(order.id)">
                      {{ getNextStageAction(order.status) }}
                    </button>
                  </div>
                </mat-card>
              </div>
            </div>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
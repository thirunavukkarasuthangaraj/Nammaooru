<div class="orders-page">
  <!-- Page Header with Tabs -->
  <mat-card class="page-header">
    <div class="header-container">
      <div class="header-title">
        <mat-icon class="orders-icon">receipt_long</mat-icon>
        <h1>My Orders</h1>
      </div>
    </div>

    <!-- Status Tabs -->
    <mat-tab-group [selectedIndex]="getSelectedTabIndex()"
                   (selectedIndexChange)="onTabChange(statusTabs[$event].key)"
                   class="order-tabs">
      <mat-tab *ngFor="let tab of statusTabs" [label]="tab.label"></mat-tab>
    </mat-tab-group>
  </mat-card>

  <!-- Main Content -->
  <div class="orders-content">

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading your orders...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && orders.length === 0" class="empty-state">
      <mat-icon class="empty-icon">shopping_bag</mat-icon>
      <h2>No Orders Yet</h2>
      <p>You haven't placed any orders yet. Start shopping to see your orders here!</p>
      <button mat-raised-button color="primary" (click)="continueShopping()">
        <mat-icon>store</mat-icon>
        Start Shopping
      </button>
    </div>

    <!-- Orders List -->
    <div *ngIf="!loading && orders.length > 0" class="orders-list">
      <mat-card class="order-card" *ngFor="let order of orders" [class.expanded]="isOrderExpanded(order)">
        <mat-card-content (click)="viewOrderDetails(order)">
          <!-- Order Header -->
          <div class="order-header">
            <div class="order-info">
              <div class="order-number">Order #{{order.orderNumber}}</div>
              <div class="order-date">{{formatDate(order.createdAt)}}</div>
            </div>
            <div class="status-chip" [style.background-color]="getStatusColor(order.status)">
              {{order.status}}
            </div>
          </div>

          <!-- Order Items Summary -->
          <div class="order-summary">
            <div class="items-summary">
              <span class="items-count">{{order.items?.length || 0}} item{{(order.items?.length || 0) > 1 ? 's' : ''}}</span>
              <span class="items-preview">{{getItemsPreview(order)}}</span>
            </div>
          </div>

          <!-- Expandable Order Details -->
          <div class="order-details" *ngIf="isOrderExpanded(order)">
            <div class="details-header">
              <mat-icon>receipt</mat-icon>
              <span>Order Items</span>
            </div>
            <div class="items-list">
              <div class="order-item" *ngFor="let item of order.items">
                <img class="item-image"
                     [src]="item.productImageUrl || '/assets/images/product-placeholder.jpg'"
                     [alt]="item.productName"
                     (error)="onImageError($event)">
                <div class="item-info">
                  <div class="item-name">{{item.productName}}</div>
                  <div class="item-quantity">Qty: {{item.quantity}}</div>
                </div>
                <div class="item-price">₹{{item.totalPrice || (item.unitPrice * item.quantity)}}</div>
              </div>
            </div>
          </div>

          <!-- Order Footer -->
          <div class="order-footer">
            <div class="amount-section">
              <div class="total-amount">₹{{order.totalAmount}}</div>
              <div class="payment-method">{{formatPaymentMethod(order.paymentMethod)}}</div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons" (click)="$event.stopPropagation()">
              <button mat-stroked-button color="warn" class="compact-btn"
                      *ngIf="canCancelOrder(order)"
                      (click)="cancelOrder(order)">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

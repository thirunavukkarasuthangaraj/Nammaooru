<div class="product-list-container">
  <!-- Shop Header -->
  <mat-card class="shop-header-card" *ngIf="shop">
    <mat-card-content>
      <div class="shop-header">
        <button mat-stroked-button 
                color="primary"
                class="back-button"
                (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          Back to Shops
        </button>
        <div class="shop-info">
          <img [src]="shop.image || '/assets/images/shop-placeholder.svg'" 
               class="shop-logo" 
               [alt]="shop.name">
          <div class="shop-details">
            <h2 class="shop-name">{{shop.name}}</h2>
            <p class="shop-description">{{shop.description || 'Premium electronics and gadgets store'}}</p>
            <div class="shop-metrics">
              <div class="metrics-container">
                <span class="metric-badge">
                  <mat-icon class="metric-icon">star</mat-icon>
                  {{shop.rating || '4.2'}}
                </span>
                <span class="metric-badge">
                  <mat-icon class="metric-icon">schedule</mat-icon>
                  {{shop.deliveryTime || '30-45'}} min
                </span>
                <span class="metric-badge">
                  <mat-icon class="metric-icon">local_shipping</mat-icon>
                  Delivery ₹{{shop.deliveryFee || '50'}}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="content-wrapper">
    <!-- Filters Sidebar -->
    <div class="filters-sidebar">
      <mat-card class="filter-card">
        <mat-card-header>
          <mat-card-title>Filters</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <!-- Search -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Search products</mat-label>
            <mat-icon matPrefix>search</mat-icon>
            <input matInput 
                   [(ngModel)]="searchTerm" 
                   (keyup)="onSearch()"
                   placeholder="Search...">
            <button mat-icon-button matSuffix 
                    *ngIf="searchTerm" 
                    (click)="searchTerm=''; onSearch()">
              <mat-icon>clear</mat-icon>
            </button>
          </mat-form-field>

          <!-- Categories -->
          <div class="filter-section">
            <h3 class="filter-title">Categories</h3>
            <mat-radio-group [(ngModel)]="selectedCategory" 
                             (change)="onCategoryChange()" 
                             class="category-list">
              <mat-radio-button value="" class="category-option">
                <span class="category-label">All Categories</span>
              </mat-radio-button>
              <mat-radio-button *ngFor="let category of categories" 
                                [value]="category" 
                                class="category-option">
                <span class="category-label">{{category}}</span>
              </mat-radio-button>
            </mat-radio-group>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Cart Summary -->
      <mat-card class="cart-summary-card" *ngIf="cartItemCount > 0">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>shopping_cart</mat-icon>
            Cart ({{cartItemCount}} items)
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="cart-info">
            <span class="cart-label">Subtotal:</span>
            <span class="cart-value">₹{{cartTotal}}</span>
          </div>
          <button mat-raised-button 
                  color="accent" 
                  class="full-width checkout-btn"
                  (click)="goToCart()">
            <mat-icon>shopping_cart_checkout</mat-icon>
            View Cart & Checkout
          </button>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Products Section -->
    <div class="products-section">
      <mat-card class="products-container">
        <mat-card-header class="products-header">
          <mat-card-title>Products ({{products.length}})</mat-card-title>
          <mat-form-field appearance="outline" class="sort-field">
            <mat-label>Sort by</mat-label>
            <mat-select [(value)]="sortBy" (selectionChange)="onSortChange()">
              <mat-option value="name">Name</mat-option>
              <mat-option value="price-low">Price: Low to High</mat-option>
              <mat-option value="price-high">Price: High to Low</mat-option>
              <mat-option value="popular">Most Popular</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-header>
        <mat-card-content>
          <!-- Loading -->
          <div class="row" *ngIf="loading">
            <div class="col-12 text-center py-5">
              <mat-spinner diameter="50"></mat-spinner>
              <p class="mt-3">Loading products...</p>
            </div>
          </div>

          <!-- Products List -->
          <div class="products-list" *ngIf="!loading && products.length > 0">
            <div class="product-list-item" *ngFor="let product of products">
              <div class="product-image">
                <img [src]="product.image || '/assets/images/product-placeholder.svg'" 
                     [alt]="product.name">
                <span class="discount-badge" *ngIf="product.discount">
                  {{product.discount}}% OFF
                </span>
              </div>
              
              <div class="product-info">
                <h3 class="product-name">{{product.name}}</h3>
                <p class="product-description">{{product.description || 'Latest product with advanced features'}}</p>
                <span class="category-chip">{{product.category || 'Electronics'}}</span>
              </div>
              
              <div class="product-pricing">
                <div class="price-container">
                  <span class="price">₹{{product.price || '999'}}</span>
                  <span class="unit">/{{product.unit || 'pcs'}}</span>
                </div>
                <div class="stock-status" *ngIf="product.inStock === false">
                  <mat-icon class="out-of-stock-icon">block</mat-icon>
                  <span>Out of Stock</span>
                </div>
              </div>
              
              <div class="product-actions">
                <div class="quantity-selector" *ngIf="getProductCartQuantity(product.id) > 0 && product.inStock !== false">
                  <button mat-icon-button 
                          color="primary"
                          (click)="decreaseQuantity(product)">
                    <mat-icon>remove_circle_outline</mat-icon>
                  </button>
                  <span class="quantity">{{getProductCartQuantity(product.id)}}</span>
                  <button mat-icon-button 
                          color="primary"
                          (click)="increaseQuantity(product)">
                    <mat-icon>add_circle_outline</mat-icon>
                  </button>
                </div>
                <button mat-raised-button 
                        color="primary" 
                        class="add-to-cart-btn"
                        *ngIf="getProductCartQuantity(product.id) === 0 && product.inStock !== false"
                        (click)="addToCart(product)">
                  <mat-icon>add_shopping_cart</mat-icon>
                  Add to Cart
                </button>
                <button mat-button disabled *ngIf="product.inStock === false">
                  Out of Stock
                </button>
              </div>
            </div>
          </div>

          <!-- No Products -->
          <div class="row" *ngIf="!loading && products.length === 0">
            <div class="col-12 text-center py-5">
              <mat-icon class="display-1 text-muted">shopping_basket</mat-icon>
              <h5 class="text-muted mt-3">No products found</h5>
              <p class="text-muted">Try adjusting your search or category filter</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

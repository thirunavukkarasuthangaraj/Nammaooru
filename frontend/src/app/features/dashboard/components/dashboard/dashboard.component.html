<div class="dashboard-container">
  <div class="header-section">
    <h2>Dashboard Overview</h2>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard metrics...</p>
  </div>

  <div *ngIf="!loading && metrics" class="dashboard-content">
    <!-- Key Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card users">
        <div class="stat-icon">
          <mat-icon>people</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalUsers) }}</div>
          <div class="stat-label">Total Users</div>
        </div>
      </div>

      <div class="stat-card orders">
        <div class="stat-icon">
          <mat-icon>shopping_cart</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalOrders) }}</div>
          <div class="stat-label">Total Orders</div>
        </div>
      </div>

      <div class="stat-card shops">
        <div class="stat-icon">
          <mat-icon>store</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalShops) }}</div>
          <div class="stat-label">Total Shops</div>
        </div>
      </div>

      <div class="stat-card customers">
        <div class="stat-icon">
          <mat-icon>person</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalCustomers) }}</div>
          <div class="stat-label">Customers</div>
        </div>
      </div>

      <div class="stat-card delivery">
        <div class="stat-icon">
          <mat-icon>local_shipping</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(metrics.totalDeliveryPartners) }}</div>
          <div class="stat-label">Delivery Partners</div>
        </div>
      </div>

      <div class="stat-card amount">
        <div class="stat-icon">
          <mat-icon>attach_money</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(metrics.totalOrderAmount) }}</div>
          <div class="stat-label">Total Order Amount</div>
        </div>
      </div>

      <div class="stat-card refund">
        <div class="stat-icon">
          <mat-icon>money_off</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(metrics.totalRefundAmount) }}</div>
          <div class="stat-label">Total Refund Amount</div>
        </div>
      </div>
    </div>

    <!-- Daily Orders Chart -->
    <div class="chart-section">
      <mat-card class="chart-card">
        <mat-card-content>
          <highcharts-chart 
            [Highcharts]="Highcharts"
            [options]="chartOptions"
            style="width: 100%; height: 350px; display: block;">
          </highcharts-chart>
          
          <div class="chart-stats" *ngIf="metrics?.dailyOrdersData">
            <div class="chart-stat">
              <span class="label">Average Orders:</span>
              <span class="value">{{ (metrics.dailyOrdersData.reduce((sum, d) => sum + d.orders, 0) / metrics.dailyOrdersData.length) | number:'1.0-0' }}</span>
            </div>
            <div class="chart-stat">
              <span class="label">Average Value:</span>
              <span class="value">{{ formatCurrency(metrics.dailyOrdersData.reduce((sum, d) => sum + d.avgValue, 0) / metrics.dailyOrdersData.length) }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Performance Sections -->
    <div class="performance-section">
      <!-- Top Performing Shops -->
      <mat-card class="performance-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>store</mat-icon>
            Top Performing Shops
          </mat-card-title>
          <mat-card-subtitle>Based on revenue and orders</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="shop-list" *ngIf="metrics.topShops && metrics.topShops.length > 0; else noShops">
            <div class="shop-item" *ngFor="let shop of metrics.topShops; let i = index">
              <div class="shop-rank">{{ i + 1 }}</div>
              <div class="shop-avatar">
                <mat-icon>storefront</mat-icon>
              </div>
              <div class="shop-info">
                <h4>{{ shop.name }}</h4>
                <p>{{ shop.owner }}</p>
                <div class="shop-rating">
                  <mat-icon class="star">star</mat-icon>
                  <span>{{ shop.rating }}</span>
                </div>
              </div>
              <div class="shop-metrics">
                <div class="metric">
                  <span class="value">{{ formatCurrency(shop.revenue) }}</span>
                  <span class="label">Revenue</span>
                </div>
                <div class="metric">
                  <span class="value">{{ formatNumber(shop.orders) }}</span>
                  <span class="label">Orders</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noShops>
            <div class="no-data">
              <mat-icon>store</mat-icon>
              <p>No shop data available</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- Category Performance -->
      <mat-card class="performance-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>category</mat-icon>
            Category Performance
          </mat-card-title>
          <mat-card-subtitle>Market share and trends</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="category-list" *ngIf="metrics.categoryPerformance && metrics.categoryPerformance.length > 0; else noCategories">
            <div class="category-item" *ngFor="let category of metrics.categoryPerformance">
              <div class="category-info">
                <h4>{{ category.name }}</h4>
                <div class="category-stats">
                  <span class="revenue">{{ formatCurrency(category.revenue) }}</span>
                  <span class="orders">{{ formatNumber(category.orders) }} orders</span>
                </div>
              </div>
              <div class="category-performance">
                <div class="market-share">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="category.marketShare"></div>
                  </div>
                  <span class="percentage">{{ category.marketShare }}%</span>
                </div>
                <div class="trend" [class.positive]="category.trend.startsWith('+')">
                  <mat-icon>{{ category.trend.startsWith('+') ? 'trending_up' : 'trending_down' }}</mat-icon>
                  <span>{{ category.trend }}</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noCategories>
            <div class="no-data">
              <mat-icon>category</mat-icon>
              <p>No category data available</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
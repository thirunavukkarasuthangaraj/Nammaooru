<div class="dashboard-container">
  <div class="header-section">
    <h2>Dashboard</h2>
    <mat-form-field appearance="outline" class="period-selector">
      <mat-label>Time Period</mat-label>
      <mat-select [(ngModel)]="selectedPeriod" (selectionChange)="onPeriodChange()">
        <mat-option *ngFor="let period of periodOptions" [value]="period.value">
          {{ period.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard metrics...</p>
  </div>

  <div *ngIf="!loading && metrics" class="dashboard-content">
    <!-- Key Metrics Grid -->
    <div class="metrics-grid">
      <app-metric-card
        title="Total Revenue"
        [value]="formatCurrency(metrics.totalRevenue)"
        icon="attach_money"
        color="primary"
        [growth]="metrics.monthlyGrowth">
      </app-metric-card>

      <app-metric-card
        title="Total Orders"
        [value]="formatNumber(metrics.totalOrders)"
        icon="shopping_cart"
        color="accent"
        [growth]="5.2">
      </app-metric-card>

      <app-metric-card
        title="Total Customers"
        [value]="formatNumber(metrics.totalCustomers)"
        icon="people"
        color="warn"
        [growth]="3.8">
      </app-metric-card>

      <app-metric-card
        title="Active Shops"
        [value]="formatNumber(metrics.totalShops)"
        icon="store"
        color="primary"
        [growth]="2.1">
      </app-metric-card>

      <app-metric-card
        title="Avg Order Value"
        [value]="formatCurrency(metrics.averageOrderValue)"
        icon="trending_up"
        color="accent"
        [growth]="1.5">
      </app-metric-card>

      <app-metric-card
        title="Conversion Rate"
        [value]="formatPercentage(metrics.conversionRate)"
        icon="percent"
        color="warn"
        [growth]="0.8">
      </app-metric-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Revenue Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Revenue Trend</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-placeholder">
            <mat-icon>show_chart</mat-icon>
            <p>Revenue chart will be displayed here</p>
            <small>Integration with Chart.js or similar library needed</small>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Orders Chart -->
      <mat-card class="chart-card">
        <mat-card-header>
          <mat-card-title>Orders Overview</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="chart-placeholder">
            <mat-icon>bar_chart</mat-icon>
            <p>Orders chart will be displayed here</p>
            <small>Integration with Chart.js or similar library needed</small>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Additional Insights -->
    <div class="insights-section">
      <!-- Top Performing Shops -->
      <mat-card class="insights-card">
        <mat-card-header>
          <mat-card-title>Top Performing Shops</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="shop-list" *ngIf="metrics.topShops && metrics.topShops.length > 0; else noShops">
            <div class="shop-item" *ngFor="let shop of metrics.topShops; let i = index">
              <div class="shop-rank">{{ i + 1 }}</div>
              <div class="shop-info">
                <h4>{{ shop.shopName }}</h4>
                <p>{{ shop.shopOwner }}</p>
              </div>
              <div class="shop-metrics">
                <div class="metric">
                  <span class="label">Revenue:</span>
                  <span class="value">{{ formatCurrency(shop.revenue) }}</span>
                </div>
                <div class="metric">
                  <span class="label">Orders:</span>
                  <span class="value">{{ formatNumber(shop.orderCount) }}</span>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noShops>
            <div class="no-data">
              <mat-icon>store</mat-icon>
              <p>No shop data available</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- Category Performance -->
      <mat-card class="insights-card">
        <mat-card-header>
          <mat-card-title>Category Performance</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="category-list" *ngIf="metrics.categoryData && metrics.categoryData.length > 0; else noCategories">
            <div class="category-item" *ngFor="let category of metrics.categoryData">
              <div class="category-info">
                <h4>{{ category.categoryName }}</h4>
                <div class="category-metrics">
                  <span class="revenue">{{ formatCurrency(category.revenue) }}</span>
                  <span class="orders">{{ formatNumber(category.orderCount) }} orders</span>
                </div>
              </div>
              <div class="category-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="category.marketShare || 0"></div>
                </div>
                <span class="market-share">{{ formatPercentage(category.marketShare || 0) }}</span>
              </div>
            </div>
          </div>
          <ng-template #noCategories>
            <div class="no-data">
              <mat-icon>category</mat-icon>
              <p>No category data available</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="actions-section">
      <mat-card class="actions-card">
        <mat-card-header>
          <mat-card-title>Quick Actions</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="actions-grid">
            <button mat-raised-button color="primary" routerLink="/orders">
              <mat-icon>shopping_cart</mat-icon>
              View All Orders
            </button>
            <button mat-raised-button color="accent" routerLink="/dashboard/analytics">
              <mat-icon>analytics</mat-icon>
              Detailed Analytics
            </button>
            <button mat-raised-button color="warn" routerLink="/users">
              <mat-icon>people</mat-icon>
              Manage Users
            </button>
            <button mat-raised-button routerLink="/settings">
              <mat-icon>settings</mat-icon>
              System Settings
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
<div class="forgot-password-container">
  <!-- Background Image with Overlay -->
  <div class="background-image">
    <img
      src="assets/images/background.png"
      alt="Fresh vegetables background"
      class="bg-img">
    <div class="overlay"></div>
  </div>

  <!-- Content Wrapper -->
  <div class="content-wrapper">
    <!-- Logo and Brand -->
    <div class="brand-section">
      <h1 class="brand-title">NammaOoru</h1>
      <p class="brand-tagline">Reset your password</p>
    </div>

    <!-- Forgot Password Form Card -->
    <div class="form-card">
      <!-- Step 1: Email Form -->
      <div *ngIf="currentStep === 'email'">
        <div class="form-header">
          <h2>Forgot Password?</h2>
          <p>Enter your email to receive a reset code</p>
        </div>

        <form [formGroup]="emailForm" (ngSubmit)="onEmailSubmit()" class="forgot-form">
          <div class="form-field">
            <label for="email">Email</label>
            <div class="input-wrapper">
              <span class="material-icons-outlined input-icon">mail_outline</span>
              <input
                id="email"
                type="email"
                formControlName="email"
                placeholder="you@example.com"
                [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            </div>
            <span class="error-message" *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
              <ng-container *ngIf="emailForm.get('email')?.hasError('required')">Email is required</ng-container>
              <ng-container *ngIf="emailForm.get('email')?.hasError('email')">Enter a valid email</ng-container>
            </span>
          </div>

          <button
            type="submit"
            class="submit-button"
            [disabled]="emailForm.invalid || isLoading">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <span *ngIf="!isLoading">Send Reset Code</span>
            <span *ngIf="isLoading">Sending...</span>
          </button>

          <p class="signup-link">
            Remember your password?
            <a routerLink="/auth/login">Back to Login</a>
          </p>

          <p class="privacy-link">
            <a routerLink="/privacy-policy">Privacy Policy</a>
          </p>
        </form>
      </div>

      <!-- Step 2: OTP Form -->
      <div *ngIf="currentStep === 'otp'">
        <div class="form-header">
          <h2>Enter Verification Code</h2>
          <p>We sent a code to {{ email }}</p>
        </div>

        <form [formGroup]="otpForm" (ngSubmit)="onOtpSubmit()" class="forgot-form">
          <div class="form-field">
            <label for="otp">6-Digit Code</label>
            <div class="input-wrapper">
              <span class="material-icons-outlined input-icon">security</span>
              <input
                id="otp"
                type="text"
                formControlName="otp"
                placeholder="000000"
                maxlength="6"
                [class.error]="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched">
            </div>
            <span class="error-message" *ngIf="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched">
              <ng-container *ngIf="otpForm.get('otp')?.hasError('required')">Code is required</ng-container>
              <ng-container *ngIf="otpForm.get('otp')?.hasError('pattern')">Enter a valid 6-digit code</ng-container>
            </span>
          </div>

          <button
            type="submit"
            class="submit-button"
            [disabled]="otpForm.invalid || isLoading">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <span *ngIf="!isLoading">Verify Code</span>
            <span *ngIf="isLoading">Verifying...</span>
          </button>

          <div class="resend-section">
            <button
              type="button"
              class="link-button"
              [disabled]="resendTimer > 0 || isLoading"
              (click)="resendOtp()">
              <span *ngIf="resendTimer > 0">Resend in {{ resendTimer }}s</span>
              <span *ngIf="resendTimer <= 0">Resend Code</span>
            </button>
          </div>

          <p class="signup-link">
            <a (click)="goBack()" style="cursor: pointer;">Change Email</a>
          </p>
        </form>
      </div>

      <!-- Step 3: New Password Form -->
      <div *ngIf="currentStep === 'password'">
        <div class="form-header">
          <h2>Create New Password</h2>
          <p>Enter your new password below</p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()" class="forgot-form">
          <div class="form-field">
            <label for="newPassword">New Password</label>
            <div class="input-wrapper">
              <span class="material-icons-outlined input-icon">lock_outline</span>
              <input
                id="newPassword"
                [type]="hideNewPassword ? 'password' : 'text'"
                formControlName="newPassword"
                placeholder="••••••••"
                [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
              <button
                class="toggle-password"
                type="button"
                (click)="hideNewPassword = !hideNewPassword">
                <span class="material-icons-outlined">
                  {{ hideNewPassword ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
            <span class="error-message" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
              {{ passwordForm.get('newPassword')?.hasError('required') ? 'Password is required' : 'Minimum 8 characters' }}
            </span>
          </div>

          <div class="form-field">
            <label for="confirmPassword">Confirm Password</label>
            <div class="input-wrapper">
              <span class="material-icons-outlined input-icon">lock_outline</span>
              <input
                id="confirmPassword"
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="••••••••"
                [class.error]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
              <button
                class="toggle-password"
                type="button"
                (click)="hideConfirmPassword = !hideConfirmPassword">
                <span class="material-icons-outlined">
                  {{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
            <span class="error-message" *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched || passwordForm.hasError('passwordMismatch')">
              <ng-container *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">Confirm password is required</ng-container>
              <ng-container *ngIf="passwordForm.hasError('passwordMismatch') && !passwordForm.get('confirmPassword')?.hasError('required')">Passwords do not match</ng-container>
            </span>
          </div>

          <button
            type="submit"
            class="submit-button"
            [disabled]="passwordForm.invalid || isLoading">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <span *ngIf="!isLoading">Reset Password</span>
            <span *ngIf="isLoading">Resetting...</span>
          </button>

          <p class="signup-link">
            <a (click)="goBack()" style="cursor: pointer;">Back to Code</a>
          </p>
        </form>
      </div>
    </div>
  </div>
</div>

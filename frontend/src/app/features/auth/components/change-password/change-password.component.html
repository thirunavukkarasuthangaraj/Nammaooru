<div class="change-password-container">
  <div class="change-password-card">
    <div class="header">
      <mat-icon class="icon">security</mat-icon>
      <h1 class="title">Change Password</h1>
      <p class="subtitle" *ngIf="isTemporaryPassword">
        For security reasons, you must change your temporary password before continuing.
      </p>
      <p class="subtitle" *ngIf="!isTemporaryPassword">
        Create a new password for your account.
      </p>
    </div>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="change-password-form">
      <!-- Current Password Field (only if not temporary) -->
      <mat-form-field appearance="outline" *ngIf="!isTemporaryPassword">
        <mat-label>Current Password</mat-label>
        <input
          matInput
          [type]="hideCurrentPassword ? 'password' : 'text'"
          formControlName="currentPassword"
          autocomplete="current-password">
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideCurrentPassword = !hideCurrentPassword"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideCurrentPassword">
          <mat-icon>{{hideCurrentPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('currentPassword')?.invalid">
          {{getErrorMessage('currentPassword')}}
        </mat-error>
      </mat-form-field>

      <!-- New Password Field -->
      <mat-form-field appearance="outline">
        <mat-label>New Password</mat-label>
        <input
          matInput
          [type]="hideNewPassword ? 'password' : 'text'"
          formControlName="newPassword"
          autocomplete="new-password">
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideNewPassword = !hideNewPassword"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideNewPassword">
          <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('newPassword')?.invalid">
          {{getErrorMessage('newPassword')}}
        </mat-error>
      </mat-form-field>

      <!-- Confirm Password Field -->
      <mat-form-field appearance="outline">
        <mat-label>Confirm New Password</mat-label>
        <input
          matInput
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmPassword"
          autocomplete="new-password">
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="hideConfirmPassword = !hideConfirmPassword"
          [attr.aria-label]="'Hide password'"
          [attr.aria-pressed]="hideConfirmPassword">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('confirmPassword')?.invalid || changePasswordForm.hasError('passwordMismatch')">
          {{getErrorMessage('confirmPassword')}}
        </mat-error>
      </mat-form-field>

      <!-- Password Requirements -->
      <div class="password-requirements">
        <h4>Password Requirements:</h4>
        <ul>
          <li [class.valid]="hasMinLength()">
            At least 8 characters long
          </li>
          <li [class.valid]="hasLowercase()">
            At least one lowercase letter
          </li>
          <li [class.valid]="hasUppercase()">
            At least one uppercase letter
          </li>
          <li [class.valid]="hasNumber()">
            At least one number
          </li>
          <li [class.valid]="hasSpecialChar()">
            At least one special character (@$!%*?&)
          </li>
        </ul>
      </div>

      <!-- Submit Button -->
      <button
        mat-raised-button
        color="primary"
        type="submit"
        class="submit-btn"
        [disabled]="!changePasswordForm.valid || loading">
        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
        <span *ngIf="!loading">Change Password</span>
        <span *ngIf="loading">Updating...</span>
      </button>
    </form>
  </div>
</div>

<div class="partner-orders-container">
  <mat-card class="orders-card">
    <mat-card-header>
      <mat-card-title>My Orders</mat-card-title>
      <mat-card-subtitle>Manage your assigned deliveries</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Loading orders...</p>
      </div>

      <div *ngIf="!isLoading">
        <mat-table [dataSource]="dataSource" class="orders-table">
          <ng-container matColumnDef="orderNumber">
            <mat-header-cell *matHeaderCellDef>Order #</mat-header-cell>
            <mat-cell *matCellDef="let order">{{order.orderNumber}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="customerName">
            <mat-header-cell *matHeaderCellDef>Customer</mat-header-cell>
            <mat-cell *matCellDef="let order">{{order.customerName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="shopName">
            <mat-header-cell *matHeaderCellDef>Shop</mat-header-cell>
            <mat-cell *matCellDef="let order">{{order.shopName}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="deliveryAddress">
            <mat-header-cell *matHeaderCellDef>Delivery Address</mat-header-cell>
            <mat-cell *matCellDef="let order">{{order.deliveryAddress}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
            <mat-cell *matCellDef="let order">
              <mat-chip [color]="getStatusColor(order.status)" selected>
                {{order.status | titlecase}}
              </mat-chip>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="amount">
            <mat-header-cell *matHeaderCellDef>Amount</mat-header-cell>
            <mat-cell *matCellDef="let order">&#8377;{{order.totalAmount}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="actions">
            <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
            <mat-cell *matCellDef="let order">
              <button mat-icon-button [matMenuTriggerFor]="actionMenu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #actionMenu="matMenu">
                <button mat-menu-item (click)="viewOrderDetails(order.orderId)">
                  <mat-icon>visibility</mat-icon>
                  <span>View Details</span>
                </button>
                <button mat-menu-item *ngIf="order.status === 'accepted'" (click)="startDelivery(order.orderId)">
                  <mat-icon>local_shipping</mat-icon>
                  <span>Mark Picked Up</span>
                </button>
                <button mat-menu-item *ngIf="order.status === 'picked_up' || order.status === 'in_transit'" (click)="completeDelivery(order.orderId)">
                  <mat-icon>check_circle</mat-icon>
                  <span>Mark Delivered</span>
                </button>
              </mat-menu>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>

        <div *ngIf="dataSource.data.length === 0" class="no-orders">
          <mat-icon>assignment</mat-icon>
          <p>No active orders at the moment</p>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
